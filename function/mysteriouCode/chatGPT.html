<!doctype html>
<html> 
    <head> 
        <meta charset="UTF-8"> 
        <meta name="viewport" id="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> 
        <title>积木·chatGPT</title>
        <link rel="icon" type="image/x-icin" href="../../images/logo.ico">
        <script src="../../tools/jQuery3.6.3_min.js"></script>
        <link rel="stylesheet" href="../../tools/bootstrap.min.css">
        <style>
            * {
                margin: 0;
                padding: 0;
            }
            /* 头部 */

            .header {
                height: 10%;
                padding: 10px;
                text-align: center;
            }
            .header img {
                width: 40px;
            }
            .header span {
                font-size: 25px;
                font-weight: bolder;
                vertical-align: bottom;
                margin-left: 5px;
            }

            /* 对话框 */

            .dialogBox {
                width: 80%;
                background-color: #efefef;
                margin: 10px auto;
                padding: 10px;
                border-radius: 15px;
                overflow: auto;
            }
            .dialogBox .left {
                text-align: left;
            }
            .dialogBox .right {
                text-align: right;
            }
            .dialogBox img {
                width: 40px;
                margin-top: 10px;
            }
            .dialogBox .leftContent,
            .dialogBox .rightContent {
                margin: 0 10px;
                padding: 10px;
                border-radius: 5px;
            }
            .dialogBox .leftContent {
                background-color: #fff;
                color: #424242;
            }
            .dialogBox .rightContent {
                background-color: skyblue;
                color: #fff;
            }

            /* 输入框 */

        	.inputBox {
                position: fixed;
                bottom: 10px;
                width: 100%;
                height: 50px;
                text-align: center;
            }
            .inputBox input {
                width: 70%;
                height: 100%;
                border: none;
                border-radius: 8px;
                outline-style: none;
                background-color: #efefef;
                padding: 5px 10px;
             }
             .inputBox .send {
                width: 66px;
                height: 80%;
                border: none;
                background-color: #abf;
                border-radius: 5px;
             }
        </style>
    </head> 
    <body>
		<div class="header">
            <img src="../../images/chatGPT.png" alt="log"><span>chatGPT</span>
        </div>
        <div class="dialogBox">
            <p class="left">
                <img src="../../images/chatGPT.png" alt="chatGPT-log">
            </p>
            <p class="leftContent">
                <span class="left">您需要什么帮助呢？</span>
            </p>
        </div>
        <div class="inputBox">
            <input class="text" type="text" placeholder="请输入内容">
            <button class="send">发送</button>
        </div>
        <script>
        	$(function () {
                $('.dialogBox').css('height', ($(window).height()) * 0.8)
                function getData() {
                    var text = $('.text').val();
                    if(text === '') return alert('请输入内容');
                    $('.dialogBox').append('<p class="right"><img src="../../images/logo.png" alt="logo"></p><p class="rightContent"><span>' + text +'</span></p><p class="left"><img src="../../images/chatGPT.png" alt="chatGPT-log"></p><p class="leftContent"><span>chatGPT正在思考中...</span></p>')
                    $('.text').val('')
                    $('.dialogBox').scrollTop($('.dialogBox').prop('scrollHeight'))
                    $.get('https://api.vvhan.com/api/jm', {key : '0310', string : 'IjNBUnR2SHc3cXZtTjB6YzR2RUdielo3bjlWZ01UVng2emMwS1NSZDVHbGY4VUxTaE5HYU5Sek9FbkswenllbzJkYUZlTGtOaDVQcStyRmRrRUxGTzVnPT0i', type : 'de'}, function (res){
                        var Authorization = 'Bearer ' + res.demissString,
                            data = JSON.stringify({
                                model : 'text-davinci-003',
                                user : '1',
                                max_tokens : 1000,
                                temperature : 0.5,
                                frequency_penalty : 0,
                                presence_penalty : 0,
                                prompt : text
                            });
                        $.ajax({
                            url : 'https://api.openai.com/v1/completions',
                            type : 'post',
                            dataType : 'json',
                            headers : {
                                Authorization : Authorization,
                                'Content-Type' : 'application/json'
                            },
                            data : data,
                            success : function (res) {
                                $('.dialogBox p:last-child span').html(res.choices[0].text)
                                $('.dialogBox').scrollTop($('.dialogBox').prop('scrollHeight'))
                            },
                            error : function (err) {
                                err = JSON.parse(err.responseText)
                                $('.dialogBox p:last-child span').html(err.error.message)
                                $('.dialogBox').scrollTop($('.dialogBox').prop('scrollHeight'))
                            }
                        })
                    })
                }
                $('.send').on('click', getData)
                $(window).on('keydown', function (e) {
                    if(e.keyCode == 13) getData();
                })
			})
        </script> 	
    </body>
</html>